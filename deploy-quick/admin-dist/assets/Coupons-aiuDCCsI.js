import{r as o,j as e}from"./index-DOxEGdKT.js";import{L}from"./Layout-BE-ntlVZ.js";import{C as l,b as c,c as d,T as p,E as T,a as D,S as U}from"./i18n-B411-pDw.js";import{a as k}from"./api-CLxMmQJN.js";import{S}from"./index-C87imYVj.js";import{B as i}from"./button-DgKdKgQi.js";import{M as _,R as B}from"./ReloadOutlined-6BN3SnDC.js";import{R as G,C as $}from"./index-50YUuaol.js";import{R as W,C as h}from"./row-BwxrU85I.js";import{I as Y}from"./index-BSvmuOKN.js";import{R as q}from"./Input-CUo6ECZN.js";import{S as z,F as H,T as u,R as J}from"./DeleteOutlined-BiMnbOGP.js";import{s as j}from"./index-BXb1MVlp.js";import{R as K}from"./EditOutlined-D9s6iUJU.js";import"./UserOutlined-8APkalxd.js";import"./ExclamationCircleFilled-Byg_8rfJ.js";import"./CloseCircleFilled-CLg-dlze.js";function ue(){const[E,F]=o.useState([]),[g,C]=o.useState(!1),[x,y]=o.useState(""),[f,w]=o.useState(""),[m,b]=o.useState(""),[s,M]=o.useState({current:1,pageSize:10,total:0}),n=async(t=1,a=10)=>{C(!0);try{const r={page:t,limit:a};x&&(r.search=x),f&&(r.status=f),m&&(r.type=m);const I=(await k.get("/coupons",{params:r})).data;F(I.data||[]),M({...s,total:I.total||0,current:t})}catch(r){console.error("获取优惠券列表失败:",r),j.error(T.loadFailed)}finally{C(!1)}},P=async t=>{try{await k.delete(`/coupons/${t}`),j.success(U.deleteSuccess),n(s.current,s.pageSize)}catch(a){console.error("删除优惠券失败:",a),j.error(T.deleteFailed)}},N=()=>{n(1,s.pageSize)},v=()=>{n(1,s.pageSize)},O=()=>{y(""),w(""),b(""),n(1,s.pageSize)};o.useEffect(()=>{n()},[]);const A=[{title:"优惠券代码",dataIndex:"code",key:"code",width:120,render:t=>e.jsx("span",{style:{fontWeight:"bold",color:"#1890ff"},children:t})},{title:p.type,dataIndex:"type",key:"type",width:100,render:t=>{const a=c[t];return a?e.jsx(u,{children:a.label}):e.jsx(u,{children:t})}},{title:p.discount,dataIndex:"discount",key:"discount",width:80,render:(t,a)=>a.type==="percentage"?`${t}%`:a.type==="fixed"?`¥${t.toFixed(2)}`:"免运费"},{title:p.status,dataIndex:"status",key:"status",width:100,render:t=>{const a=d[t];return a?e.jsx(u,{color:a.color,children:a.label}):e.jsx(u,{children:t})}},{title:"有效期",dataIndex:"validFrom",key:"validPeriod",width:160,render:(t,a)=>{const r=new Date(a.validFrom).toLocaleDateString("zh-CN"),R=new Date(a.validTo).toLocaleDateString("zh-CN");return`${r} ~ ${R}`}},{title:"使用次数",dataIndex:"usageCount",key:"usageCount",width:100,render:(t,a)=>`${a.usageCount}/${a.maxUsage}`},{title:p.actions,key:"actions",width:150,render:(t,a)=>e.jsxs(S,{children:[e.jsx(i,{type:"primary",size:"small",icon:e.jsx(K,{}),onClick:()=>{_.info({title:"编辑优惠券",content:`编辑功能开发中... (优惠券ID: ${a.id})`})},children:l.edit}),e.jsx(D,{title:"删除优惠券",description:"确定要删除这个优惠券吗？",onConfirm:()=>P(a.id),okText:"确定",cancelText:"取消",okButtonProps:{danger:!0},children:e.jsx(i,{danger:!0,size:"small",icon:e.jsx(J,{}),children:l.delete})})]})}];return e.jsx(L,{children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex-between mb-4",children:[e.jsx("h1",{children:"优惠券列表"}),e.jsxs(S,{children:[e.jsxs(i,{type:"primary",icon:e.jsx(G,{}),onClick:()=>{_.info({title:"新增优惠券",content:"新增优惠券功能开发中..."})},children:[l.add,"优惠券"]}),e.jsx(i,{icon:e.jsx(B,{}),onClick:N,loading:g,children:l.refresh})]})]}),e.jsx($,{style:{marginBottom:16},children:e.jsxs(W,{gutter:16,children:[e.jsx(h,{span:6,children:e.jsx(Y.Search,{placeholder:"搜索优惠券代码...",icon:e.jsx(q,{}),value:x,onChange:t=>y(t.target.value),onSearch:v,allowClear:!0})}),e.jsx(h,{span:6,children:e.jsx(z,{placeholder:"选择优惠券类型",style:{width:"100%"},value:m,onChange:t=>b(t),allowClear:!0,options:[{label:c.fixed.label,value:"fixed"},{label:c.percentage.label,value:"percentage"},{label:c.free_shipping.label,value:"free_shipping"}]})}),e.jsx(h,{span:6,children:e.jsx(z,{placeholder:"选择优惠券状态",style:{width:"100%"},value:f,onChange:t=>w(t),allowClear:!0,options:[{label:d.active.label,value:"active"},{label:d.expired.label,value:"expired"},{label:d.disabled.label,value:"disabled"}]})}),e.jsx(h,{span:6,children:e.jsxs(S,{style:{width:"100%",justifyContent:"flex-end"},children:[e.jsx(i,{type:"primary",onClick:v,children:l.search}),e.jsx(i,{onClick:O,children:l.reset})]})})]})}),e.jsx($,{children:e.jsx(H,{columns:A,dataSource:E.map(t=>({...t,key:t.id})),loading:g,pagination:{current:s.current,pageSize:s.pageSize,total:s.total,showSizeChanger:!0,showTotal:t=>`共 ${t} 条记录`,onChange:(t,a)=>n(t,a)},scroll:{x:1200}})})]})})}export{ue as default};
