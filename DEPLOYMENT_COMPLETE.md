# ğŸš€ Ruizhu ç”µå•†å¹³å° - éƒ¨ç½²å®ŒæˆæŠ¥å‘Š

**éƒ¨ç½²æ—¥æœŸ**: 2025-10-26
**æœåŠ¡å™¨**: Tencent Cloud (è…¾è®¯äº‘) - 123.207.14.67
**çŠ¶æ€**: âœ… **å·²æˆåŠŸéƒ¨ç½²**

---

## ğŸ“ è®¿é—®åœ°å€

| æœåŠ¡ | URL | çŠ¶æ€ |
|------|-----|------|
| ğŸŒ **ç®¡ç†åå°** | http://123.207.14.67 | âœ… è¿è¡Œä¸­ |
| ğŸ”Œ **API æœåŠ¡** | http://123.207.14.67/api/v1 | âœ… è¿è¡Œä¸­ |
| ğŸ“Š **åç«¯ç«¯å£** (å†…éƒ¨) | 127.0.0.1:3000 | âœ… è¿è¡Œä¸­ |
| ğŸ’¾ **æ•°æ®åº“** | gz-cdb-qtjza6az.sql.tencentcdb.com:27226 | âœ… è¿æ¥ä¸­ |

---

## âœ… éƒ¨ç½²å®Œæˆçš„ç»„ä»¶

### 1. å‰ç«¯åº”ç”¨ (React Admin Dashboard)
- **ä½ç½®**: `/opt/ruizhu-app/admin-dist`
- **æŠ€æœ¯**: React + Vite
- **æœåŠ¡æ–¹å¼**: Nginx é™æ€æ–‡ä»¶æœåŠ¡
- **çŠ¶æ€**: âœ… æ­£å¸¸è¿è¡Œ (HTTP 200 OK)

### 2. åç«¯ API æœåŠ¡ (NestJS)
- **ä½ç½®**: `/opt/ruizhu-app/nestapi-dist`
- **æŠ€æœ¯**: NestJS + TypeORM
- **è¿›ç¨‹ç®¡ç†**: PM2 é›†ç¾¤æ¨¡å¼ (2 ä¸ªå®ä¾‹)
- **è¿è¡Œç«¯å£**: 3000 (å†…éƒ¨é€šè¿‡ Nginx ä»£ç†)
- **çŠ¶æ€**: âœ… 2 ä¸ªå®ä¾‹è¿è¡Œä¸­ (online)

### 3. Web æœåŠ¡å™¨ (Nginx)
- **ç‰ˆæœ¬**: 1.26.3 (Baota é¢æ¿ç®¡ç†)
- **ç›‘å¬ç«¯å£**: 80 (HTTP)
- **åå‘ä»£ç†**: âœ… é…ç½®å®Œæˆ
- **è™šæ‹Ÿä¸»æœº**: `/www/server/panel/vhost/nginx/ruizhu.conf`
- **çŠ¶æ€**: âœ… é…ç½®æœ‰æ•ˆ

### 4. æ•°æ®åº“ (Tencent CDB MySQL)
- **è¿æ¥**: mysql://root:***@gz-cdb-qtjza6az.sql.tencentcdb.com:27226/mydb
- **è¡¨æ•°é‡**: 32 ä¸ªè¡¨ (å·²åˆå§‹åŒ–)
- **çŠ¶æ€**: âœ… å¯è¿æ¥

---

## ğŸ”§ æœåŠ¡ç®¡ç†å‘½ä»¤

### PM2 è¿›ç¨‹ç®¡ç†
```bash
# SSH è¿æ¥åˆ°æœåŠ¡å™¨
ssh root@123.207.14.67

# æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
pm2 list

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
pm2 logs ruizhu-backend

# æŸ¥çœ‹å®æ—¶æ—¥å¿— (æœ€å30è¡Œ)
pm2 logs ruizhu-backend --lines 30

# é‡å¯æœåŠ¡
pm2 restart ruizhu-backend

# åœæ­¢æœåŠ¡
pm2 stop ruizhu-backend

# å¯åŠ¨æœåŠ¡
pm2 start ruizhu-backend

# åˆ é™¤è¿›ç¨‹
pm2 delete ruizhu-backend
```

### Nginx ç®¡ç†
```bash
# é‡å¯ Nginx
systemctl restart nginx

# æŸ¥çœ‹çŠ¶æ€
systemctl status nginx

# æµ‹è¯•é…ç½®
/www/server/nginx/sbin/nginx -t

# é‡æ–°åŠ è½½é…ç½®
/www/server/nginx/sbin/nginx -s reload
```

### æ•°æ®åº“ç®¡ç†
```bash
# è¿æ¥åˆ°äº‘æ•°æ®åº“
mysql -h gz-cdb-qtjza6az.sql.tencentcdb.com -P 27226 -u root -p

# è¾“å…¥å¯†ç : Pp123456

# æŸ¥çœ‹æ•°æ®åº“
SHOW DATABASES;

# é€‰æ‹©æ•°æ®åº“
USE mydb;

# æŸ¥çœ‹è¡¨
SHOW TABLES;
```

---

## ğŸ“‚ æœåŠ¡å™¨æ–‡ä»¶ç»“æ„

```
/opt/ruizhu-app/
â”œâ”€â”€ nestapi-dist/              # åç«¯ç¼–è¯‘æ–‡ä»¶
â”‚   â”œâ”€â”€ main.js                # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ node_modules/          # ç”Ÿäº§ä¾èµ– (313 ä¸ªåŒ…)
â”‚   â””â”€â”€ ...
â”œâ”€â”€ admin-dist/                # å‰ç«¯æ‰“åŒ…æ–‡ä»¶
â”‚   â”œâ”€â”€ index.html             # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ assets/                # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ index-DOxEGdKT.js
â”‚   â”‚   â”œâ”€â”€ index-HXEpsLh4.css
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ vite.svg
â”œâ”€â”€ .env.production            # ç”Ÿäº§ç¯å¢ƒå˜é‡
â””â”€â”€ database-init-corrected.sql # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

/www/server/nginx/
â”œâ”€â”€ conf/
â”‚   â”œâ”€â”€ nginx.conf             # ä¸»é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ ...
â”œâ”€â”€ sbin/
â”‚   â””â”€â”€ nginx                  # Nginx äºŒè¿›åˆ¶
â””â”€â”€ logs/

/www/server/panel/vhost/nginx/
â””â”€â”€ ruizhu.conf                # Ruizhu è™šæ‹Ÿä¸»æœºé…ç½®
```

---

## ğŸ“Š éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Internet (Port 80)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP è¯·æ±‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Nginx (Port 80)               â”‚
        â”‚  Reverse Proxy & Static Serve  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         /                       \
        /                         \
    (å‰ç«¯)                     (API)
    /api/v1/*                    /api/*
       â–¼                            â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  /admin-dist/        â”‚   â”‚ PM2 Backend     â”‚
  â”‚  (é™æ€HTML/CSS/JS)   â”‚   â”‚ NestJS (x2)     â”‚
  â”‚                      â”‚   â”‚ Port 3000       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚ SQL æŸ¥è¯¢
                                      â–¼
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚ Tencent CDB MySQL    â”‚
                             â”‚ gz-cdb-qtjza6az...   â”‚
                             â”‚ Port 27226           â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: åç«¯æœåŠ¡æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹æ—¥å¿—
pm2 logs ruizhu-backend

# æ£€æŸ¥ç¯å¢ƒå˜é‡
cat /opt/ruizhu-app/.env.production

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :3000

# æ£€æŸ¥ä¾èµ–æ˜¯å¦å®‰è£…
ls /opt/ruizhu-app/nestapi-dist/node_modules/@nestjs/core
```

### é—®é¢˜ 2: å‰ç«¯ 404 é”™è¯¯
```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /opt/ruizhu-app/admin-dist/

# æ£€æŸ¥æƒé™
stat /opt/ruizhu-app/admin-dist/index.html

# é‡å¯ Nginx
systemctl restart nginx
```

### é—®é¢˜ 3: API è¿æ¥è¶…æ—¶
```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
mysql -h gz-cdb-qtjza6az.sql.tencentcdb.com -P 27226 -u root -p

# æ£€æŸ¥é˜²ç«å¢™
# (éœ€è¦è”ç³»æœåŠ¡å™¨æä¾›å•†)

# æŸ¥çœ‹ Nginx æ—¥å¿—
tail -f /www/wwwlogs/ruizhu-error.log
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å·²å¯ç”¨çš„ä¼˜åŒ–
- âœ… **Nginx Gzip å‹ç¼©**: å‡å°‘ä¼ è¾“ä½“ç§¯
- âœ… **é™æ€èµ„æºç¼“å­˜**: è®¾ç½® 30 å¤©è¿‡æœŸæ—¶é—´
- âœ… **PM2 é›†ç¾¤æ¨¡å¼**: å……åˆ†åˆ©ç”¨å¤šæ ¸ CPU
- âœ… **æœ€å¤§å†…å­˜é™åˆ¶**: å•ä¸ªè¿›ç¨‹ 500MB
- âœ… **è¿æ¥ä¿æŒæ´»åŠ¨**: keepalive 60 ç§’

### ç›‘æ§å»ºè®®
1. å®šæœŸæ£€æŸ¥ PM2 è¿›ç¨‹å†…å­˜ä½¿ç”¨
2. ç›‘æ§æ•°æ®åº“è¿æ¥æ•°
3. æ£€æŸ¥ Nginx é”™è¯¯æ—¥å¿—
4. ä½¿ç”¨ top/htop ç›‘æ§ç³»ç»Ÿèµ„æº

---

## ğŸ” å®‰å…¨å»ºè®®

### ç«‹å³æ‰§è¡Œ
- [ ] ä¿®æ”¹ root å¯†ç 
- [ ] ä¿®æ”¹ JWT_SECRET (å½“å‰: `your-secret-key-change-this`)
- [ ] ä¿®æ”¹ WeChat æ”¯ä»˜é…ç½®ä¿¡æ¯
- [ ] é…ç½®é˜²ç«å¢™è§„åˆ™

### å»ºè®®æ‰§è¡Œ
- [ ] å¯ç”¨ HTTPS/SSL è¯ä¹¦
- [ ] é…ç½® SSH å¯†é’¥è®¤è¯
- [ ] å®šæœŸå¤‡ä»½æ•°æ®åº“
- [ ] é…ç½®ç›‘æ§å‘Šè­¦

---

## ğŸ“ åç»­ç»´æŠ¤

### æ—¥å¸¸æ“ä½œ
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 list

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs ruizhu-backend

# é‡å¯æœåŠ¡ (ç”¨äºæ›´æ–°ä»£ç å)
pm2 restart ruizhu-backend
```

### ä»£ç æ›´æ–°æµç¨‹
```bash
# 1. åœ¨æœ¬åœ°æ„å»º
npm run build

# 2. ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp -r nestapi/dist root@123.207.14.67:/opt/ruizhu-app/
scp -r admin/dist root@123.207.14.67:/opt/ruizhu-app/

# 3. SSH è¿æ¥åˆ°æœåŠ¡å™¨
ssh root@123.207.14.67

# 4. é‡å¯æœåŠ¡
pm2 restart ruizhu-backend
systemctl reload nginx
```

---

## âœ… éƒ¨ç½²éªŒè¯æ¸…å•

- [x] åç«¯ç¼–è¯‘æˆåŠŸ
- [x] å‰ç«¯æ‰“åŒ…æˆåŠŸ
- [x] æ–‡ä»¶ä¸Šä¼ å®Œæˆ
- [x] ç¯å¢ƒå˜é‡é…ç½®
- [x] æ•°æ®åº“åˆå§‹åŒ– (32 è¡¨)
- [x] PM2 è¿›ç¨‹å¯åŠ¨ (2 å®ä¾‹ online)
- [x] Nginx è™šæ‹Ÿä¸»æœºé…ç½®
- [x] å‰ç«¯è®¿é—®æµ‹è¯• (HTTP 200)
- [x] API æœåŠ¡å™¨æµ‹è¯• (å“åº”æ­£å¸¸)
- [x] åå‘ä»£ç†é…ç½®

---

## ğŸ“ é‡è¦ä¿¡æ¯

**æœåŠ¡å™¨ä¿¡æ¯**
- IP: 123.207.14.67
- ç”¨æˆ·: root
- å¯†ç : Pp123456

**æ•°æ®åº“ä¿¡æ¯**
- ä¸»æœº: gz-cdb-qtjza6az.sql.tencentcdb.com
- ç«¯å£: 27226
- ç”¨æˆ·: root
- å¯†ç : Pp123456
- æ•°æ®åº“: mydb

**åç«¯æœåŠ¡**
- å¯åŠ¨æ–‡ä»¶: `/opt/ruizhu-app/nestapi-dist/main.js`
- ç«¯å£: 3000
- PM2 è¿›ç¨‹å: `ruizhu-backend`
- å®ä¾‹æ•°: 2 (é›†ç¾¤æ¨¡å¼)

**å‰ç«¯åº”ç”¨**
- è·¯å¾„: `/opt/ruizhu-app/admin-dist/`
- å…¥å£: `index.html`
- æœåŠ¡å™¨: Nginx (Port 80)

---

**éƒ¨ç½²å®Œæˆæ—¶é—´**: 2025-10-26 21:55 UTC
**éƒ¨ç½²ç‰ˆæœ¬**: 1.0.0
**ç¯å¢ƒ**: Production (ç”Ÿäº§ç¯å¢ƒ)

ğŸ‰ **éƒ¨ç½²æˆåŠŸï¼Ruizhu ç”µå•†å¹³å°å·²æ­£å¼ä¸Šçº¿ï¼**
